<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (head unchanged) ... -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Seven Royal Stars School Management System</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,700&display=swap">
  <style>
    /* ... (styles unchanged for brevity) ... */
    /* [RETAIN YOUR CSS FROM ORIGINAL HERE] */
  </style>
</head>
<body>
<div class="container">
  <!-- ... (HTML layout unchanged) ... -->
  <!-- [RETAIN YOUR HTML LAYOUT FROM ORIGINAL HERE] -->
</div>

<!-- Chart.js for analytics (optional, not used in this starter) -->
<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
<script>
// Data structure
const CLASS_LIST = [
  "Nursery 1", "Nursery 2", "Kindergarten 1", "Kindergarten 2",
  "Primary 1", "Primary 2", "Primary 3", "Primary 4", "Primary 5", "Primary 6",
  "JHS 1", "JHS 2", "JHS 3"
];
const SUBJECTS = ["Math", "English", "Science", "Social Studies", "ICT", "French", "Ghanaian Language", "RME"];
let db = {
  students: [],
  teachers: [],
  classes: [],
  attendance: [],
  grades: [],
  fees: [],
  settings: { schoolName: "Seven Royal Stars School" }
};
// Demo users
let users = [
  {username: 'admin', password: 'admin123', role: 'admin', name: 'Administrator', status: 'active'},
  {username: 'teacher', password: 'teacher123', role: 'teacher', name: 'Teacher', status: 'active'}
];
let currentUser = null, currentSection = 'students';

// ----------- MASS POPULATE DEMO DATA ------------
function randomPhoto(seed) {
  // Generate a simple avatar image using the seed (student/teacher initials)
  return `https://ui-avatars.com/api/?name=${encodeURIComponent(seed)}&background=25a978&color=fff&rounded=true&size=64`;
}
function populateDemoData() {
  // Populate students
  db.students = [
    {name:'Ama Mensah', photo:randomPhoto('Ama Mensah'), class:'Primary 1', parent:'Kofi Mensah', emergency:'0240000001', status:'Active'},
    {name:'Kwame Boateng', photo:randomPhoto('Kwame Boateng'), class:'Primary 2', parent:'Akua Boateng', emergency:'0240000002', status:'Active'},
    {name:'Akosua Owusu', photo:randomPhoto('Akosua Owusu'), class:'Primary 3', parent:'Yaw Owusu', emergency:'0240000003', status:'Active'},
    {name:'Yaw Addo', photo:randomPhoto('Yaw Addo'), class:'JHS 1', parent:'Mansa Addo', emergency:'0240000004', status:'Active'},
    {name:'Kwabena Agyapong', photo:randomPhoto('Kwabena Agyapong'), class:'JHS 2', parent:'Ama Agyapong', emergency:'0240000005', status:'Active'},
    {name:'Efua Darko', photo:randomPhoto('Efua Darko'), class:'Primary 4', parent:'Kojo Darko', emergency:'0240000006', status:'Active'},
    {name:'Kojo Antwi', photo:randomPhoto('Kojo Antwi'), class:'Primary 5', parent:'Abena Antwi', emergency:'0240000007', status:'Inactive'},
    {name:'Abena Asare', photo:randomPhoto('Abena Asare'), class:'Kindergarten 2', parent:'Samuel Asare', emergency:'0240000008', status:'Active'},
    {name:'Nana Kofi', photo:randomPhoto('Nana Kofi'), class:'Nursery 2', parent:'Akua Kofi', emergency:'0240000009', status:'Active'},
    {name:'Mansa Opoku', photo:randomPhoto('Mansa Opoku'), class:'Primary 2', parent:'Yaw Opoku', emergency:'0240000010', status:'Active'},
    {name:'Kojo Mensah', photo:randomPhoto('Kojo Mensah'), class:'JHS 2', parent:'Ama Mensah', emergency:'0240000011', status:'Active'},
    {name:'Akua Frimpong', photo:randomPhoto('Akua Frimpong'), class:'Primary 6', parent:'Kwame Frimpong', emergency:'0240000012', status:'Active'},
    {name:'Yaw Appiah', photo:randomPhoto('Yaw Appiah'), class:'JHS 3', parent:'Serwaa Appiah', emergency:'0240000013', status:'Active'},
    {name:'Afia Owusu', photo:randomPhoto('Afia Owusu'), class:'Primary 1', parent:'Owusu Mensah', emergency:'0240000014', status:'Inactive'},
    {name:'Samuel Sarpong', photo:randomPhoto('Samuel Sarpong'), class:'Primary 3', parent:'Akosua Sarpong', emergency:'0240000015', status:'Active'}
  ];
  // Populate teachers
  db.teachers = [
    {name:'Mrs. Serwaa', email:'serwaa@school.edu', qualification:'B.Ed', assignedClass:'JHS 1', status:'Active'},
    {name:'Mr. Owusu', email:'owusu@school.edu', qualification:'M.Ed Science', assignedClass:'Primary 3', status:'Active'},
    {name:'Madam Akua', email:'akua@school.edu', qualification:'B.Ed English', assignedClass:'Primary 1', status:'Active'},
    {name:'Mr. Boateng', email:'boateng@school.edu', qualification:'B.Ed Mathematics', assignedClass:'Primary 5', status:'Active'},
    {name:'Mrs. Mensah', email:'mensah@school.edu', qualification:'B.Ed French', assignedClass:'Primary 4', status:'Active'},
    {name:'Mr. Addo', email:'addo@school.edu', qualification:'M.Ed ICT', assignedClass:'JHS 2', status:'Active'},
    {name:'Madam Abena', email:'abena@school.edu', qualification:'B.Ed KG', assignedClass:'Kindergarten 2', status:'Active'}
  ];
  // Populate classes
  db.classes = [
    {className:'Nursery 1', room:'A1', teacher:'Miss Akua'},
    {className:'Nursery 2', room:'A2', teacher:'Mr. Kwesi'},
    {className:'Kindergarten 1', room:'B1', teacher:'Madam Abena'},
    {className:'Kindergarten 2', room:'B2', teacher:'Madam Abena'},
    {className:'Primary 1', room:'C1', teacher:'Madam Akua'},
    {className:'Primary 2', room:'C2', teacher:'Mr. Johnson'},
    {className:'Primary 3', room:'C3', teacher:'Mr. Owusu'},
    {className:'Primary 4', room:'C4', teacher:'Mrs. Mensah'},
    {className:'Primary 5', room:'C5', teacher:'Mr. Boateng'},
    {className:'Primary 6', room:'C6', teacher:'Mr. Amponsah'},
    {className:'JHS 1', room:'D1', teacher:'Mrs. Serwaa'},
    {className:'JHS 2', room:'D2', teacher:'Mr. Addo'},
    {className:'JHS 3', room:'D3', teacher:'Mr. Sarpong'}
  ];
  // Populate attendance (recent 10 entries)
  db.attendance = [
    {date:'2025-06-01', class:'Primary 1', student:'Ama Mensah', status:'Present'},
    {date:'2025-06-01', class:'Primary 2', student:'Kwame Boateng', status:'Present'},
    {date:'2025-06-01', class:'Primary 3', student:'Akosua Owusu', status:'Absent'},
    {date:'2025-06-02', class:'Primary 2', student:'Mansa Opoku', status:'Present'},
    {date:'2025-06-02', class:'Primary 4', student:'Efua Darko', status:'Present'},
    {date:'2025-06-02', class:'JHS 1', student:'Yaw Addo', status:'Present'},
    {date:'2025-06-03', class:'JHS 2', student:'Kojo Mensah', status:'Absent'},
    {date:'2025-06-03', class:'JHS 2', student:'Kwabena Agyapong', status:'Present'},
    {date:'2025-06-03', class:'Primary 6', student:'Akua Frimpong', status:'Present'},
    {date:'2025-06-04', class:'JHS 3', student:'Yaw Appiah', status:'Present'}
  ];
  // Populate grades (a variety of students/classes/subjects)
  db.grades = [
    {student:'Ama Mensah', class:'Primary 1', subject:'Math', score:92, weight:'Exam'},
    {student:'Kwame Boateng', class:'Primary 2', subject:'English', score:84, weight:'Test'},
    {student:'Akosua Owusu', class:'Primary 3', subject:'Science', score:78, weight:'Quiz'},
    {student:'Yaw Addo', class:'JHS 1', subject:'ICT', score:65, weight:'Exam'},
    {student:'Efua Darko', class:'Primary 4', subject:'Math', score:70, weight:'Test'},
    {student:'Kojo Antwi', class:'Primary 5', subject:'French', score:55, weight:'Exam'},
    {student:'Abena Asare', class:'Kindergarten 2', subject:'RME', score:80, weight:'Quiz'},
    {student:'Kojo Mensah', class:'JHS 2', subject:'Science', score:61, weight:'Assignment'},
    {student:'Akua Frimpong', class:'Primary 6', subject:'Math', score:91, weight:'Exam'},
    {student:'Yaw Appiah', class:'JHS 3', subject:'Social Studies', score:85, weight:'Exam'}
  ];
  // Populate fees (various statuses)
  db.fees = [
    {student:'Ama Mensah', class:'Primary 1', type:'Tuition', amount:1200, status:'Paid'},
    {student:'Kwame Boateng', class:'Primary 2', type:'Tuition', amount:1200, status:'Pending'},
    {student:'Akosua Owusu', class:'Primary 3', type:'Uniform', amount:200, status:'Paid'},
    {student:'Yaw Addo', class:'JHS 1', type:'Books', amount:150, status:'Pending'},
    {student:'Efua Darko', class:'Primary 4', type:'Tuition', amount:1200, status:'Paid'},
    {student:'Kojo Antwi', class:'Primary 5', type:'Exam', amount:50, status:'Pending'},
    {student:'Abena Asare', class:'Kindergarten 2', type:'Tuition', amount:1100, status:'Paid'},
    {student:'Kojo Mensah', class:'JHS 2', type:'Transport', amount:300, status:'Paid'},
    {student:'Akua Frimpong', class:'Primary 6', type:'Tuition', amount:1200, status:'Pending'},
    {student:'Yaw Appiah', class:'JHS 3', type:'Tuition', amount:1250, status:'Pending'}
  ];
  // Settings
  db.settings = { schoolName: "Seven Royal Stars School" };
}
// -----------------------------------------------

// Local storage functions
function loadDB() {
  const d = localStorage.getItem('school_db');
  if (d) db = JSON.parse(d);
}
function saveDB() {
  localStorage.setItem('school_db', JSON.stringify(db));
}
function backupData() {
  saveDB();
  const blob = new Blob([JSON.stringify(db)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'school_backup.json'; a.click();
  showNotification('Backup', 'Backup downloaded.', 'success');
}
function restoreData() {
  const input = document.createElement('input');
  input.type = 'file'; input.accept = '.json';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      try {
        db = JSON.parse(evt.target.result);
        saveDB(); renderAll();
        showNotification('Restore', 'Backup restored!', 'success');
      } catch {
        showNotification('Restore', 'Invalid backup.', 'error');
      }
    };
    reader.readAsText(file);
  };
  input.click();
}
// Import/Export CSV
function exportData() {
  let csv = "Type,Data\n";
  for (let [k, arr] of Object.entries(db)) {
    if (!Array.isArray(arr)) continue;
    arr.forEach(item => {
      csv += `${k},"${btoa(unescape(encodeURIComponent(JSON.stringify(item))))}"\n`;
    });
  }
  const blob = new Blob([csv], {type: "text/csv"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob); a.download = "school_data.csv"; a.click();
  showNotification('Export', 'Data exported as CSV.', 'success');
}
function importDataCSV(text) {
  try {
    let lines = text.trim().split('\n').slice(1);
    for (let ln of lines) {
      let [type, data] = ln.split(/,(.+)/);
      if (db[type]) db[type].push(JSON.parse(decodeURIComponent(escape(atob(data.replace(/"/g,''))))));
    }
    saveDB(); renderAll();
    showNotification('Import', 'Data imported.', 'success');
  } catch {
    showNotification('Import', 'Import failed.', 'error');
  }
}
// UI Navigation
function showSection(section) {
  currentSection = section;
  document.querySelectorAll('#mainSectionContent > section').forEach(sec => sec.classList.add('hidden'));
  const sec = document.getElementById(section + 'Section');
  if (sec) sec.classList.remove('hidden');
  renderAll();
}
function renderAll() {
  renderStats();
  renderStudentsTable();
  renderTeachersTable();
  renderClassesTable();
  renderAttendanceTable();
  renderGradesTable();
  renderFeesTable();
  document.getElementById('schoolNameDisplay').textContent = db.settings.schoolName || "Seven Royal Stars School";
}
function renderStats() {
  document.getElementById('statStudents').textContent = db.students.length;
  document.getElementById('statTeachers').textContent = db.teachers.length;
  document.getElementById('statClasses').textContent = CLASS_LIST.length;
  let pending = db.fees.filter(f => f.status !== 'Paid').reduce((a, f) => a + Number(f.amount), 0);
  document.getElementById('statFeesPending').textContent = "GHS " + pending.toFixed(2);
}
// Table renderers (unchanged...)
function renderStudentsTable() {
  const tbody = document.querySelector('#studentsTable tbody');
  const search = (document.getElementById('studentSearch') || {value:""}).value.toLowerCase();
  tbody.innerHTML = db.students.filter(s => !search || s.name.toLowerCase().includes(search)).map((s,i) => `
    <tr>
      <td>${s.name}</td>
      <td>${s.photo ? '<img src="'+s.photo+'" width="32" style="border-radius:4px">' : ''}</td>
      <td>${s.class}</td>
      <td>${s.parent}</td>
      <td>${s.emergency}</td>
      <td>${s.status}</td>
      <td>
        <button class="btn btn-secondary" onclick="editStudent(${i})">Edit</button>
        <button class="btn btn-danger" onclick="deleteStudent(${i})">Delete</button>
      </td>
    </tr>
  `).join('');
}
function renderTeachersTable() {
  const tbody = document.querySelector('#teachersTable tbody');
  tbody.innerHTML = db.teachers.map((t,i) => `
    <tr>
      <td>${t.name}</td>
      <td>${t.email}</td>
      <td>${t.qualification}</td>
      <td>${t.assignedClass}</td>
      <td>${t.status}</td>
      <td>
        <button class="btn btn-secondary" onclick="editTeacher(${i})">Edit</button>
        <button class="btn btn-danger" onclick="deleteTeacher(${i})">Delete</button>
      </td>
    </tr>
  `).join('');
}
function renderClassesTable() {
  const tbody = document.querySelector('#classesTable tbody');
  tbody.innerHTML = CLASS_LIST.map(cnm => {
    const found = db.classes.find(cls => cls.className === cnm) || {};
    return `<tr>
      <td>${cnm}</td>
      <td>${found.room || ""}</td>
      <td>${found.teacher || ""}</td>
      <td>
        <button class="btn btn-secondary" onclick="editClass('${cnm}')">Edit</button>
      </td>
    </tr>`;
  }).join('');
}
function renderAttendanceTable() {
  const tbody = document.querySelector('#attendanceTable tbody');
  tbody.innerHTML = db.attendance.map((a,i) => `
    <tr>
      <td>${a.date}</td>
      <td>${a.class}</td>
      <td>${a.student}</td>
      <td>${a.status}</td>
      <td>
        <button class="btn btn-secondary" onclick="editAttendance(${i})">Edit</button>
        <button class="btn btn-danger" onclick="deleteAttendance(${i})">Delete</button>
      </td>
    </tr>
  `).join('');
}
function renderGradesTable() {
  const tbody = document.querySelector('#gradesTable tbody');
  tbody.innerHTML = db.grades.map((g,i) => `
    <tr>
      <td>${g.student}</td>
      <td>${g.class}</td>
      <td>${g.subject}</td>
      <td>${g.score}</td>
      <td>${g.weight}</td>
      <td>
        <button class="btn btn-secondary" onclick="editGrade(${i})">Edit</button>
        <button class="btn btn-danger" onclick="deleteGrade(${i})">Delete</button>
      </td>
    </tr>
  `).join('');
}
function renderFeesTable() {
  const tbody = document.querySelector('#feesTable tbody');
  tbody.innerHTML = db.fees.map((f,i) => `
    <tr>
      <td>${f.student}</td>
      <td>${f.class}</td>
      <td>${f.type}</td>
      <td>GHS ${Number(f.amount).toFixed(2)}</td>
      <td>${f.status}</td>
      <td>
        <button class="btn btn-secondary" onclick="editFee(${i})">Edit</button>
        <button class="btn btn-danger" onclick="deleteFee(${i})">Delete</button>
      </td>
    </tr>
  `).join('');
}
// Login/Logout (unchanged)
function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const role = document.getElementById('userRole').value;
  const alert = document.getElementById('loginAlert');
  const u = users.find(u=>u.username===username && u.password===password && u.role===role);
  if (u && u.status==='active') {
    currentUser = {...u};
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('userDisplay').classList.remove('hidden');
    document.getElementById('userDisplay').textContent = u.name.charAt(0);
    document.getElementById('logoutBtn').style.display = '';
    showSection('students');
    alert.innerHTML = '';
    showNotification('Welcome', `Hello ${u.name}!`, 'success');
  } else {
    alert.innerHTML = '<div class="alert alert-error">Invalid credentials or user inactive.</div>';
  }
}
function logout() {
  currentUser = null;
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('loginSection').classList.remove('hidden');
  document.getElementById('userDisplay').classList.add('hidden');
  document.getElementById('userDisplay').textContent = '';
  document.getElementById('logoutBtn').style.display = 'none';
  showNotification('Logged out', 'You have been logged out.', 'info');
}
// Modal helpers (unchanged)
function showModal(id) {
  document.getElementById(id).style.display = 'block';
}
function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}
// Notification system (unchanged)
function showNotification(title, message, type='info', autoHide=3500) {
  const container = document.getElementById('notificationContainer');
  const noti = document.createElement('div');
  noti.className = `notification ${type}`;
  noti.innerHTML = `<b>${title}</b><div style="margin-left:10px;">${message}</div>
      <span class="noti-close" onclick="this.parentElement.remove()">Ã—</span>`;
  container.appendChild(noti);
  setTimeout(()=>{if(noti)noti.remove();},autoHide);
}
// Data CRUD stubs (expand for full CRUD + modals)
function editStudent(i){ alert('Edit student not implemented in this demo'); }
function deleteStudent(i){ db.students.splice(i,1); saveDB(); renderAll(); showNotification('Student', 'Deleted.', 'success'); }
function editTeacher(i){ alert('Edit teacher not implemented in this demo'); }
function deleteTeacher(i){ db.teachers.splice(i,1); saveDB(); renderAll(); showNotification('Teacher', 'Deleted.', 'success'); }
function editClass(name){ alert('Edit class not implemented in this demo'); }
function editAttendance(i){ alert('Edit attendance not implemented in this demo'); }
function deleteAttendance(i){ db.attendance.splice(i,1); saveDB(); renderAll(); showNotification('Attendance', 'Deleted.', 'success'); }
function editGrade(i){ alert('Edit grade not implemented in this demo'); }
function deleteGrade(i){ db.grades.splice(i,1); saveDB(); renderAll(); showNotification('Grade', 'Deleted.', 'success'); }
function editFee(i){ alert('Edit fee not implemented in this demo'); }
function deleteFee(i){ db.fees.splice(i,1); saveDB(); renderAll(); showNotification('Fee', 'Deleted.', 'success'); }

// Initial data
if(!localStorage.getItem('school_db')) {
  populateDemoData();
  saveDB();
}
loadDB();
// INIT
window.onload = () => {
  renderAll();
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('loginSection').classList.remove('hidden');
  document.getElementById('userDisplay').classList.add('hidden');
  document.getElementById('logoutBtn').style.display = 'none';
};
window.onbeforeunload = () => { saveDB(); };
</script>
</body>
</html>
